<% # Usuarios activos en el tiempo de la actividad %>
<% condr = "" %>
<% if f.object && f.object.fecha && f.object.fecha.to_s != '' %>
  <% condr += "(fechacreacion <= '#{f.object.fecha}'" %>
  <% condr += " AND (fechadeshabilitacion IS NULL OR " +
    "fechadeshabilitacion >= '#{f.object.fecha}'))" %>
<% end %>
<% if f.object && f.object.responsable %>
  <% condr += " OR (id = #{f.object.responsable.id})" %>
<% end %>
<% lus = Usuario.all %>
<% if condr != '' %>
  <% lus = lus.where("#{condr}") %>
<% end %>
<% if current_usuario.oficina_id %>
  <% lus = lus.where(oficina_id: current_usuario.oficina_id) %>
<% end %>
<%= f.association :responsable,
  collection: lus.order(:nusuario),
  include_blank: false,
  label: "Responsable",
  label_method: lambda { |t|  t.presenta_nombre },
#    r = t.nusuario
#    if t.nombre then r += " - " + t.nombre end
#    r 
#  },
  value_method: :id,
  selected:  f.object.usuario_id ?  f.object.usuario_id : current_usuario.id,
  input_html: { class: 'chosen-select' }
%>
